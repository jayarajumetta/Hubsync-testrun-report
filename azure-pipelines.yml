# Node.js
# Build a general Node.js project with npm.
# Add steps that analyze code, save build artifacts, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/javascript

trigger:
- master

pool:
  name: ILQA

steps:
- task: NodeTool@0
  inputs:
    versionSpec: '10.x'
  displayName: 'Install Node.js'

- script: |
    npm install
    npm install -g mocha
    npm install -g mochawesome-report-generator
  displayName: 'npm install'

- task: CmdLine@2
  inputs:
    script: |
      echo current working directory
      dir
      echo Generating Report
      ./generate_report.sh
    workingDirectory: '$(System.DefaultWorkingDirectory)'

- task: CustomEmail@1
  inputs:
    To: 'jayarajum@ideyalabs.com'
    Cc: 'sreejam@hubsync.com'
    From: 'sreejam@hubsync.com'
    Subject: 'HTML File Notification'
    Body: 'Please find the attached report'
    AddAttachment: true
    Attachment: '$(System.DefaultWorkingDirectory)/mochawesome-report/Hubsync_test_run_report.html'
    SmtpServer: 'smtp.office365.com'
    SmtpPort: '587'
    SmtpUsername: 'sreejam@hubsync.com'
    SmtpPassword: 'Ideyalabs&123'
    UseSSL: true
